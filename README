# üõ°Ô∏è Comnect Guardians 

> **M√≥dulo de gamifica√ß√£o educativa para Cyber Security com elementos de RPG**  
> Desenvolvido como projeto solo e integrado a um sistema interno corporativo (Orion Connect)

---

## üìã √çndice

- [Sobre o M√≥dulo](#sobre-o-m√≥dulo)
- [Stack Tecnol√≥gica](#stack-tecnol√≥gica)
- [Arquitetura](#arquitetura)
- [Minigames e Desafios](#minigames-e-desafios)
- [Sistema de Gamifica√ß√£o](#sistema-de-gamifica√ß√£o)
- [Modo Externo](#modo-externo)
- [Painel Administrativo](#painel-administrativo)
- [Banco de Dados](#banco-de-dados)
- [Patch Notes](#patch-notes)

---

## Sobre o M√≥dulo

O **Guardians Platform** √© um sistema de gamifica√ß√£o educativa desenvolvido para engajar colaboradores em treinamentos de seguran√ßa da informa√ß√£o de forma progressiva e interativa. Inspirado em jogos de RPG e plataformas de e-learning, transforma conte√∫dos de cyber security em uma experi√™ncia com progress√£o real, recompensas e competi√ß√£o saud√°vel.

O m√≥dulo foi desenvolvido integralmente por mim como uma extens√£o de um sistema interno corporativo, cobrindo todas as camadas: modelagem do banco, l√≥gica de neg√≥cio, templates, sistema de gamifica√ß√£o e deploy.

### O que o sistema oferece

- Cinco tipos de minigames educativos com mec√¢nicas distintas
- Sistema de progress√£o RPG com especializa√ß√µes, n√≠veis e √°rvore de habilidades
- Loja de upgrades com sistema Gacha, raridade de itens e controle de expira√ß√£o
- Conquistas (ins√≠gnias) com b√¥nus passivos permanentes e destaque no perfil
- Miss√µes semanais com recompensas e rastreamento de progresso
- Ranking global e perfil p√∫blico personaliz√°vel
- Modo externo para colaboradores de fora do time principal
- Painel administrativo completo com analytics e controle de conte√∫do

---

## Stack Tecnol√≥gica

```
Backend      ‚Üí Python 3.13 / Flask (Blueprints)
ORM          ‚Üí SQLAlchemy + Flask-Migrate (Alembic)
Banco        ‚Üí MySQL (PyMySQL)
Auth         ‚Üí Flask-Login + SessionManager customizado
Frontend     ‚Üí Jinja2 + Bootstrap 5
JavaScript   ‚Üí Vanilla JS + Chart.js
Deploy       ‚Üí Windows Server (Waitress WSGI)
Avatares     ‚Üí DiceBear API (bottts)
```

### Decis√µes de Design

**Blueprints Flask** ‚Äî o m√≥dulo Guardians √© isolado em seu pr√≥prio blueprint (`guardians_bp`), com rotas de jogador e rotas admin separadas em arquivos distintos.

**Decorators personalizados** ‚Äî controle granular de acesso com `login_required`, `guardian_admin_required` e `externo_required`, garantindo que cada rota s√≥ seja acess√≠vel pelo perfil correto.

**Macros Jinja2** ‚Äî componentes reutiliz√°veis para UI complexa (assistente in-game, galeria de conquistas, gest√£o de externos) evitando duplica√ß√£o de HTML entre templates.

**SessionManager customizado** ‚Äî camada de abstra√ß√£o sobre a sess√£o Flask para centralizar autentica√ß√£o e leitura de contexto de usu√°rio.

---

## Arquitetura

```
modules/
‚îî‚îÄ‚îÄ guardians/
    ‚îú‚îÄ‚îÄ routes.py                   # Rotas de jogadores e externos
    ‚îî‚îÄ‚îÄ admin_refactored_routes.py  # Rotas do painel admin v2

templates/
‚îî‚îÄ‚îÄ guardians/
    ‚îú‚îÄ‚îÄ page_central.html           # Central de desafios (internos)
    ‚îú‚îÄ‚îÄ page_central_externa.html   # Central de desafios (externos)
    ‚îú‚îÄ‚îÄ page_meu_perfil.html        # Perfil completo (internos)
    ‚îú‚îÄ‚îÄ page_perfil_externo.html    # Perfil simplificado (externos)
    ‚îú‚îÄ‚îÄ page_ranking_externo.html   # Ranking exclusivo externos
    ‚îú‚îÄ‚îÄ page_resultado_externo.html # Resultado de quiz externo
    ‚îú‚îÄ‚îÄ play_minigame_quiz.html     # Interface de quiz (compartilhada)
    ‚îú‚îÄ‚îÄ admin_guardians.html        # Hub admin principal
    ‚îú‚îÄ‚îÄ admin_analytics_hub.html    # Hub de analytics
    ‚îú‚îÄ‚îÄ admin_quiz_analysis.html    # An√°lise individual de quiz
    ‚îî‚îÄ‚îÄ macros/
        ‚îú‚îÄ‚îÄ macro_externos.html     # Gest√£o de externos (modal admin)
        ‚îú‚îÄ‚îÄ assistant_macro.html    # Assistente in-game
        ‚îî‚îÄ‚îÄ render_trophy.html      # Trof√©u de ranking

application/
‚îî‚îÄ‚îÄ models.py                       # Todos os modelos SQLAlchemy do m√≥dulo
```

---

## Minigames e Desafios

| Tipo | Descri√ß√£o | Mec√¢nica |
|------|-----------|----------|
| **Quiz** | Question√°rios de m√∫ltipla escolha sobre cyber security com timer | Score base + b√¥nus multicamada, retake com token |
| **Termo (Wordle)** | Adivinhe a palavra secreta relacionada a seguran√ßa em N tentativas | Feedback por cor de letra (posi√ß√£o e exist√™ncia) |
| **Anagrama** | Desembaralhe palavras e termos t√©cnicos para pontuar | M√∫ltiplas palavras por rodada, pontua√ß√£o por acerto |
| **Cofre de Senhas** | Crie senhas que atendam a requisitos din√¢micos e progressivos | Requisitos gerados progressivamente, valida for√ßa e complexidade |
| **Patrulha Di√°ria** | Mini-jogo di√°rio de adivinhar PIN de 4 d√≠gitos (Mastermind) | Feedback por posi√ß√£o e ocorr√™ncia, m√°ximo 10 tentativas por dia |

---

## Sistema de Gamifica√ß√£o

### C√°lculo de Pontua√ß√£o (Multicamada)

```
Pontua√ß√£o Final = Score Base
               + B√¥nus de Especializa√ß√£o  (% baseado no caminho escolhido)
               + B√¥nus de Loja            (itens passivos ativos no invent√°rio)
               + B√¥nus de Conquistas      (ins√≠gnias equipadas com b√¥nus)
               + B√¥nus de Velocidade      (conclus√£o abaixo do tempo m√©dio)
               + B√¥nus de Perfei√ß√£o       (100% de acerto)
               + B√¥nus de Streak          (multiplicador por dias consecutivos)
```

### Especializa√ß√µes (Caminhos)

Tr√™s caminhos com √°rvores de n√≠vel exclusivas, b√¥nus passivos √∫nicos e identidade visual pr√≥pria:

| Caminho | C√≥digo | Foco |
|---------|--------|------|
| üîµ Defensor | `azul` | Defesa, detec√ß√£o de amea√ßas e resposta a incidentes |
| üî¥ Hacker | `vermelho` | Ofensiva, pensamento adversarial e pen testing |
| ‚ö™ Gestor | `cinza` | Governan√ßa, gest√£o de risco e conformidade |

Troca de caminho sujeita a cooldown configur√°vel (dias) e threshold m√≠nimo de XP, ambos ajust√°veis pelo admin via `GlobalSettings`.

### Progress√£o e N√≠veis

- Cada especializa√ß√£o tem sua pr√≥pria √°rvore de `NivelSeguranca` com threshold de XP, avatar e t√≠tulo exclusivos por n√≠vel
- Progresso visual no perfil com barra de XP e indicador do pr√≥ximo n√≠vel
- Ranking global com posi√ß√£o calculada em tempo real

### Conquistas (Ins√≠gnias)

- Desbloqueadas por milestones: quizzes perfeitos, compras na loja, streak, patrulhas, etc.
- Cada ins√≠gnia pode ter b√¥nus passivo permanente (`bonus_type` + `bonus_value`)
- O guardi√£o pode equipar at√© N ins√≠gnias em destaque no perfil (configur√°vel)
- Agrupadas por categoria com ordem customiz√°vel no admin

### Streak e Sequ√™ncia

- B√¥nus multiplicador progressivo por dias consecutivos de participa√ß√£o
- Tracker visual semanal no perfil (7 indicadores coloridos por status do dia)
- Streak quebrado por inatividade, com estado `lost` rastreado para analytics

### Miss√µes Semanais

- Sets gerados semanalmente com objetivos variados (quizzes, minigames, patrulha)
- Rastreamento de progresso individual por miss√£o (`current_progress` / `target_value`)
- Recompensa em Guardian Coins ao completar todas as miss√µes do set

### Tokens de Retake

- Moeda especial obtida por desempenho perfeito (100% em quiz ou minigame)
- Configur√°vel: quantos perfeitos s√£o necess√°rios para gerar 1 token
- Permite refazer um desafio j√° conclu√≠do uma vez

### Loja de Upgrades (Guardian Coins)

Sistema de **Gacha Di√°rio** com itens renovados periodicamente:

```
Categorias de itens:
‚îú‚îÄ‚îÄ M√≥dulos Passivos  ‚Üí b√¥nus percentuais de XP por tipo de atividade (dura√ß√£o definida)
‚îú‚îÄ‚îÄ Consum√≠veis       ‚Üí tokens de retake para segunda chance nos desafios
‚îî‚îÄ‚îÄ Cosm√©ticos        ‚Üí itens visuais para personaliza√ß√£o do perfil
```

- **Reroll di√°rio**: atualiza os itens dispon√≠veis com custo crescente (1.5√ó por reroll)
- **Raridades**: Common, Rare, Epic com chances configur√°veis pelo admin
- **Invent√°rio com slots**: limite de m√≥dulos passivos ativos simult√¢neos
- **Expira√ß√£o real**: `expires_at` calculado em compra com base em `duration_days` do item

---

## Modo Externo

Modalidade simplificada desenvolvida para colaboradores fora do time principal, sem duplica√ß√£o de infraestrutura ‚Äî utiliza a mesma base de dados com isolamento l√≥gico via flag `is_externo`.

### Implementa√ß√£o T√©cnica

| Componente | Solu√ß√£o |
|------------|---------|
| Identifica√ß√£o | Coluna `is_externo` na tabela `usuarios` + flag na sess√£o Flask |
| Autentica√ß√£o | Mesmo sistema de login com redirecionamento autom√°tico p√≥s-login |
| Rastreamento | Campo `external_user_id` em `quiz_attempts` (`guardian_id` tornado nullable) |
| Avatar | Coluna `avatar_seed` persistida em `usuarios` (DiceBear API) |
| Pontua√ß√£o | Apenas score base ‚Äî sem b√¥nus, streak ou especializa√ß√£o |
| Isolamento | Ranking e perfil exclusivos, invis√≠veis para usu√°rios internos |
| Decorator | `@externo_required` bloqueia acesso de internos √†s rotas externas |

### Fluxo do Usu√°rio Externo

```
Login
  ‚îî‚îÄ‚ñ∂ Detec√ß√£o is_externo na sess√£o
        ‚îî‚îÄ‚ñ∂ central_externa (listagem de quizzes dispon√≠veis)
              ‚îî‚îÄ‚ñ∂ start_quiz_externo
                    ‚îî‚îÄ‚ñ∂ take_quiz_externo (anti-c√≥pia ativo)
                          ‚îî‚îÄ‚ñ∂ submit_quiz_externo (calcula s√≥ score base)
                                ‚îî‚îÄ‚ñ∂ page_resultado_externo
                                      ‚îú‚îÄ‚ñ∂ ranking_externo
                                      ‚îî‚îÄ‚ñ∂ meu_perfil_externo
```

### Perfil Externo

- Estat√≠sticas: posi√ß√£o no ranking, pontua√ß√£o total, quizzes feitos, precis√£o geral
- Barra de precis√£o animada via CSS transition
- Gr√°fico de evolu√ß√£o de pontua√ß√£o por quiz (Chart.js, scroll horizontal autom√°tico)
- Hist√≥rico de atividades paginado ‚Äî 10 entradas por vez com bot√£o "ver mais"
- Mensagem motivacional din√¢mica baseada na posi√ß√£o no ranking e precis√£o
- Edi√ß√£o de perfil via modal inline: nome de exibi√ß√£o e avatar

### Prote√ß√£o Anti-C√≥pia nos Quizzes

```javascript
document.addEventListener('copy',        e => e.preventDefault());
document.addEventListener('cut',         e => e.preventDefault());
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
    const blocked = (e.ctrlKey && ['c','x','a','u','s'].includes(e.key.toLowerCase()))
                 || e.key === 'F12'
                 || e.key === 'PrintScreen';
    if (blocked) e.preventDefault();
});
```

---

## Painel Administrativo

Controle completo sobre conte√∫do, usu√°rios e m√©tricas, acess√≠vel apenas a `guardian_admin` ou `portal_admin`.

| Se√ß√£o | Funcionalidades |
|-------|-----------------|
| **Gerenciar Guardi√µes** | Listar e editar perfis; promover/rebaixar admin; resetar tokens e saldo |
| **Gerenciar Conte√∫do** | CRUD completo de quizzes, quest√µes, termos, anagramas; importa√ß√£o via CSV |
| **Configura√ß√µes** | Par√¢metros globais via `GlobalSettings`: cooldowns, thresholds de XP, limites de slots |
| **Analytics Hub** | Vis√£o geral, an√°lise individual de quiz e relat√≥rio detalhado por guardi√£o |
| **Gest√£o de Externos** | Reset de temporada (todas as tentativas) e reset individual por usu√°rio e quiz |
| **Feedback Hub** | Visualiza√ß√£o e gest√£o de feedbacks enviados in-game |

### Guardian Skill Index (GSI)

M√©trica propriet√°ria calculada para cada guardi√£o combinando taxa de acerto, engajamento, streak e desempenho relativo ao grupo. Resultado: √≠ndice de **0 a 1000** exibido em gr√°fico de distribui√ß√£o e ranking Top 5 no painel.

### Analytics de Quiz

Para cada quiz, o admin visualiza taxa de acerto por quest√£o e por alternativa, distribui√ß√£o de votos, respostas individuais por guardi√£o, tempo m√©dio de conclus√£o e dificuldade relativa ao conjunto.

---

## Banco de Dados

### Modelos do M√≥dulo

```
User               ‚Üí usuarios               (auth, is_externo, avatar_seed)
Guardians          ‚Üí guardians              (perfil RPG: score, n√≠vel, streak, coins, tokens)
Specialization     ‚Üí specializations        (caminhos: azul, vermelho, cinza)
NivelSeguranca     ‚Üí niveis_seguranca       (√°rvore de n√≠veis por especializa√ß√£o)
Quiz               ‚Üí quizzes                (desafios com per√≠odo de ativa√ß√£o e expira√ß√£o)
Question           ‚Üí questions              (quest√µes com tipo e pontua√ß√£o)
AnswerOption       ‚Üí answer_options         (alternativas com flag is_correct)
QuizAttempt        ‚Üí quiz_attempts          (tentativas internas e externas)
UserAnswer         ‚Üí user_answers           (resposta de cada quest√£o por tentativa)
ShopItem           ‚Üí shop_items             (itens com b√¥nus, raridade, dura√ß√£o)
GuardianPurchase   ‚Üí guardian_purchases     (compras com expires_at calculado)
Insignia           ‚Üí insignias              (conquistas com b√¥nus passivos)
AchievementCategory‚Üí achievement_categories (categorias de conquistas ordenadas)
GuardianInsignia   ‚Üí guardian_insignias     (conquistas desbloqueadas por guardi√£o)
GuardianFeatured   ‚Üí guardian_featured      (ins√≠gnias em destaque, slot_index)
HistoricoAcao      ‚Üí historico_acoes        (log audit√°vel de a√ß√µes e pontua√ß√µes)
QuestSet           ‚Üí quest_sets             (sets de miss√µes semanais)
Mission            ‚Üí missions               (miss√µes com progresso e is_completed)
GlobalSettings     ‚Üí global_settings        (par√¢metros globais do jogo via chave-valor)
```

### Migrations Relevantes

```bash
flask db migrate -m "add is_externo to usuarios"
flask db migrate -m "add external_user_id to quiz_attempts"
flask db migrate -m "allow nullable guardian_id in quiz_attempts"
flask db migrate -m "add avatar_seed to usuarios"
flask db upgrade
```

---

## Patch Notes

### v1.2 ‚Äî Fevereiro 2026

**Balanceamento**
- Custo inicial de rolagem da loja: 5 GC ‚Üí 3 GC
- Multiplicador de custo por rolagem: 2√ó ‚Üí 1.5√ó
- Cooldown para troca de especializa√ß√£o: 14 dias ‚Üí 5 dias
- Aumentada chance de itens √âpicos e Raros na loja e em miss√µes
- Recompensa de resgate de miss√µes: +10 GC em todos os n√≠veis
- Quizzes perfeitos para gerar Token: 3 ‚Üí 5
- Novos b√¥nus passivos para os caminhos Azul e Vermelho
- Tempo limite do minigame "Segredo": 180s ‚Üí 120s

**Corre√ß√µes**
- C√°lculo de pontua√ß√£o de itens, conquistas e especializa√ß√µes corrigido
- Campo `expires_at` de `GuardianPurchase` n√£o era gravado no banco
- Bloqueado copiar, colar, Print Screen e F12 na p√°gina de quizzes
- Analytics Hub: vari√°veis n√£o inicializadas antes do bloco `try/except`
- `BuildError` em `admin_quiz_analysis.html` por endpoint inexistente
- Avatar do perfil externo sempre exibindo o default
- Reset de temporada falhando silenciosamente por viola√ß√£o de FK

**Novas Funcionalidades**
- Modo Externo completo: fluxo de quiz, ranking exclusivo e perfil com gr√°fico e hist√≥rico
- Gest√£o de externos no admin: reset de temporada e reset individual por usu√°rio/quiz
- Perfil externo com gr√°fico Chart.js, hist√≥rico paginado e mensagem motivacional din√¢mica
- Edi√ß√£o de perfil externo (nome e avatar) via modal inline
- Avatar persistido no banco (`avatar_seed`) e exibido no ranking

---

## Sobre o Desenvolvimento

Este m√≥dulo foi desenvolvido **integralmente por mim como projeto solo**, dentro de um sistema corporativo maior. Minhas responsabilidades inclu√≠ram:

- Modelagem do banco de dados e todas as migrations
- Desenvolvimento de todas as rotas e l√≥gica de neg√≥cio (backend Flask)
- Cria√ß√£o de todos os templates e componentes de interface (frontend Jinja2 + JS)
- Design completo do sistema de gamifica√ß√£o e suas mec√¢nicas
- Desenvolvimento do painel admin e das ferramentas de analytics
- Configura√ß√£o e manuten√ß√£o do ambiente de produ√ß√£o

---

*Guardians Platform ‚Äî M√≥dulo de Gamifica√ß√£o ‚Äî v1.2 ‚Äî Fevereiro 2026*
